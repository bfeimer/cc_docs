function escapeHtml(text){var map={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return text.replace(/[&<>"']/g,function(m){return map[m]})}$(document).ready(function(){$("#home_nav").addClass("ui-toolbar ui-widget-header ui-corner-tl ui-corner-tr");$(".home_nav_choices").buttonset();$("button#quick_add").button({icons:{primary:"fff-icon-add"},text:true}).click(function(){$("#quick_add_form").dialog("open")});var target=$("div#home_panel");var activitiesLoad=function(target){target.load("lib/php/data/home_activities_load.php",function(){$("a.doc_view").live("click",function(event){event.preventDefault();var itemId=$(this).attr("data-id");if($(this).hasClass("url")){$.post("lib/php/data/cases_documents_process.php",{action:"open",item_id:itemId,doc_type:"document"},function(data){var serverResponse=$.parseJSON(data);window.open(serverResponse.target_url,"_blank")})}else if($(this).hasClass("ccd")){var url=$(this).closest("p").siblings("p").find("a").attr("href");window.location.href=url}else if($(this).hasClass("pdf")){if(Object.create){$("#pdf-viewer").show();$("#frme").attr("src","lib/javascripts/pdfjs/web/viewer.html?item_id="+itemId);$("#pdf-viewer").click(function(){$("#frme").attr("src","");$(this).hide()});$("body").bind("keyup.pdfViewer",function(e){if(e.keyCode===27){$("#frme").attr("src","");$("#pdf-viewer").hide()}})}else{$.download("lib/php/data/cases_documents_process.php",{item_id:itemId,action:"open"})}}else{$.download("lib/php/data/cases_documents_process.php",{item_id:itemId,action:"open",doc_type:"document"})}});target.find("hr").last().remove()})};$("#activity_button").click(function(){activitiesLoad(target);window.activitiesRefresh=setInterval(function(){$.ajax({url:"lib/php/data/home_activities_load.php",success:function(data){target.html(data);target.find("hr").last().remove()},dataType:"html"})},9e4)});$("#upcoming_button").click(function(){clearInterval(window.activitiesRefresh);target.load("html/templates/interior/home_upcoming.php",function(){$("#calendar").fullCalendar({theme:true,aspectRatio:2,header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},eventSources:["lib/php/data/home_events_load.php"],viewDisplay:function(view){if($("img.ical").length<1){$("span.fc-button-month").before('<a href="feeds/ical.php?key='+$("#home_nav").attr("data-key")+'" target="_new"><img class="ical" title="Your iCal feed" src="html/ico/ical.png"></a>')}},dayClick:function(date,allDay,jsEvent,view){$("#quick_add").trigger("click");$("#quick_add_nav a:eq(1)").trigger("click");$("#ev_start").datetimepicker("setDate",date)},eventClick:function(event){if(event.allDay===false){event.allDay=""}else{event.allDay="Yes"}if(event.end===null){event.end=""}var route=null;if(event.caseId!=="NC"){route='<p><label>Case:</label> <a href="index.php?i=Cases.php#cases/'+event.caseId+'">'+event.caseName+"</a></p>"}else{route=""}$("div#event_detail_window").html('<a class="event_detail_close" href="#"><img src="html/ico/cross.png" border=0 title="Close">'+"</a><h3>"+escapeHtml(event.shortTitle)+'</h3><div id = "event_users_display"></div><hr /><p><label>Start:'+"</label> "+event.start+"</p><p><label>End: </label> "+event.end+"</p><p><label>All Day:</label>"+event.allDay+"</p><p><label>Where: </label>"+escapeHtml(event.where)+"</p>"+route+"<p id ="+'"event_detail_desc"><label>Description: </label>'+escapeHtml(event.description)+"</p>").dialog("open");if(event.canDelete===true){$("p#event_detail_desc").after('<br /><br /><p><a href = "#" class="event_detail_delete" data-id="'+event.id+'">Delete</a></p>')}if(event.largeGroup===true){$("div#event_users_display").css({height:"90px","overflow-y":"scroll"})}$(event.users).each(function(){var thumbImg=null;var userData=this;$.ajax({url:"people/tn_"+userData.user_id+".jpg",type:"HEAD",error:function(){thumbImg="people/tn_no_picture.png";var userThumb='<img class="thumbnail-mask" src="'+thumbImg+'" title="'+userData.full_name+'" alt="'+userData.full_name+'">';$("div#event_users_display").append(userThumb)},success:function(){thumbImg="people/tn_"+userData.user_id+".jpg";var userThumb='<img class="thumbnail-mask" src="'+thumbImg+'" title="'+userData.full_name+'" alt="'+userData.full_name+'">';$("div#event_users_display").append(userThumb)}})});$("a.event_detail_delete").live("click",function(event){event.preventDefault();var eventId=$(this).attr("data-id");var dialogWin=$('<div class="dialog-casenote-delete" title="Delete this Event?">'+"This event will be permanently deleted.  Are you sure?</div>").dialog({autoOpen:false,resizable:false,modal:true,buttons:{Yes:function(){$.post("lib/php/data/cases_events_process.php",{action:"delete",event_id:eventId},function(data){var serverResponse=$.parseJSON(data);if(serverResponse.error===true){notify(serverResponse.message,true)}else{notify(serverResponse.message);$("#calendar").fullCalendar("removeEvents",eventId);$("a.event_detail_close").trigger("click")}});$(this).dialog("destroy")},No:function(){$(this).dialog("destroy")}}});$(dialogWin).dialog("open")})}})})});$("#activity_button").trigger("click").next("label").addClass("ui-state-active");var x=$("button#quick_add").offset().left-175;var y=$("button#quick_add").offset().top+40;$("#quick_add_form").dialog({autoOpen:false,height:520,width:325,modal:true,position:[x,y]}).siblings(".ui-dialog-titlebar").remove();$("div#event_detail_window").dialog({autoOpen:false,height:400,width:500,modal:true}).siblings(".ui-dialog-titlebar").remove();$("#quick_add_form a.toggle").click(function(event){event.preventDefault();if($(this).hasClass("active")){return false}else{$(this).addClass("active");$(this).siblings("a.toggle").removeClass("active");$("div.toggle_form").toggle()}});$("#cn_date").datepicker();$("#cn_date").datepicker("setDate",new Date);$("#ev_start").datetimepicker({ampm:true,stepHours:1,stepMinute:5,hour:9,minute:0,onSelect:function(dateText,inst){$("#ev_end").datetimepicker("setDate",dateText)}});$("#ev_end").datetimepicker({ampm:true,stepHours:1,stepMinute:5,hour:10,minute:0});$("select#cn_case").chosen();$("select#ev_case").chosen();$("select#ev_users").chosen();$("button#quick_add_cn_submit").button({icons:{primary:"fff-icon-add"},text:true}).click(function(event){event.preventDefault();var cseVals=$(this).closest('form[name="quick_cn"]').serializeArray();var errString=validQuickCaseNote(cseVals);if(errString.length){$(this).closest("p").siblings("p.error").html(errString);return false}else{$.post("lib/php/data/cases_casenotes_process.php",cseVals,function(data){var serverResponse=$.parseJSON(data);if(serverResponse.error===true){$(this).closest("p").siblings("p.error").html(serverResponse.message);return false}else{notify(serverResponse.message);if($("input#activity_button").next().hasClass("ui-state-active")){activitiesLoad(target)}$("a.quick_add_close").trigger("click")}})}});$("button#quick_add_ev_submit").button({icons:{primary:"fff-icon-add"},text:true}).click(function(event){event.preventDefault();var evForm=$('form[name="quick_event"]');var evVals=evForm.not('select[name="responsibles"]').serializeArray();var resps=evForm.find('select[name="responsibles"]').val();var resps_obj=$.extend({},resps);evVals.unshift(resps_obj);var errString=validEvent(evVals);if(errString.length){$(this).closest("p").siblings("p.error").html(errString);return false}else{var allDayVal=null;if(evForm.find('input[name = "all_day"]').is(":checked")){allDayVal="on"}else{allDayVal="off"}$.post("lib/php/data/cases_events_process.php",{task:evForm.find('input[name = "task"]').val(),where:evForm.find('input[name = "where"]').val(),start:evForm.find('input[name = "start"]').val(),end:evForm.find('input[name = "end"]').val(),all_day:allDayVal,notes:evForm.find('textarea[name = "notes"]').val(),responsibles:resps,action:"add",case_id:evForm.find('select[name = "case_id"]').val()},function(data){var serverResponse=$.parseJSON(data);if(serverResponse.error===true){$(this).closest("p").siblings("p.error").html(serverResponse.message);return false}else{notify(serverResponse.message);if($("input#upcoming_button").next().hasClass("ui-state-active")){$("#calendar").fullCalendar("refetchEvents")}$("a.quick_add_close").trigger("click");evForm[0].reset;$("#ev_users").trigger("liszt:updated")}})}});$("a.quick_add_close").click(function(event){event.preventDefault();$("#quick_add_form form").each(function(){this.reset()}).find("p.error").html("");$("#cn_date").datepicker("setDate",new Date);$("#ev_start").datetimepicker("setDate","");$("select#cn_case").val("NC");$("input.ui-autocomplete-input").val($("select#cn_case option:selected").text());$("#quick_add_form").dialog("close")});$("a.event_detail_close").live("click",function(event){event.preventDefault();$("#event_detail_window").dialog("close")})});
//# sourceMappingURL=Home.map